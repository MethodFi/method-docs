---
sidebar_label: Retrieve an entity's debts
---

import EntitiesMethodDataCreateIndividualEmpty from '../../../src/snippets/EntitiesMethodDataCreateIndividualEmpty';
import ElementsCreateAuthToken from '../../../src/snippets/ElementsCreateAuthToken';
import EntitiesCreateIndividualAuthSession from '../../../src/snippets/EntitiesCreateIndividualAuthSession';
import EntitiesUpdateIndividualAuthSession from '../../../src/snippets/EntitiesUpdateIndividualAuthSession';
import ConnectionsRetrieve from '../../../src/snippets/ConnectionsRetrieve';
import ConnectionsList from '../../../src/snippets/ConnectionsList';
import AccountsHolderMethodDataList from '../../../src/snippets/AccountsHolderMethodDataList';


# Retrieve an entity's debts

Entities are a representation of your application's end-users. Method allows you to
automatically retrieve and link all of their debts.

:::note
This feature is part of Method's data product, which is separate from Method's core
payments product. Contact team@methodfi.com for more information.
:::

### Steps
- [Create an individual entity](#1-create-an-individual-entity) to represent your end-user.
- [Create an Auth element token](#2-create-an-auth-element-token) for the entity to start the identity verification process.
- [Launch the Auth Element](#3-launch-the-auth-element) with the created element token and
  complete the identity verification flow.
- [Retrieve the created connection](#4-retrieve-the-created-connection) generated by the identity verification process
- [Retrieve the created liability accounts](#5-retrieve-the-created-liability-accounts) created from the connection.

---

### 1. Create an individual entity
First we'll create an individual entity. The goal of this request is to
obtain the `data:retrieve` [capability](/guides/entities/capabilities#retrieve-data) in either the
entity's `pending_capabilities` or `available_capabilities` property.

You can also use an existing entity moving forward. The Auth Element will dynamically prompt
for more information, if required, to verify the entity.

:::caution
For non-production testing, see [Auth Element simulate requirements](/api/elements/auth/intro#simulate-requirements)
to determine what information should be required from the entity.
:::

In this example, we're creating an entity with no information.

<EntitiesMethodDataCreateIndividualEmpty />

#### Response
```json
{
  "id": "ent_au22b1fbFJbp8",
  "type": "individual",
  "individual": {
    "first_name": null,
    "last_name": null,
    "phone": null,
    "dob": null,
    "email": null
  },
  "capabilities": [],
  "available_capabilities": [],
  "pending_capabilities": [
    "payments:receive",
    "payments:send",
    "data:retrieve"
  ],
  ...
}
```

---

### 2. Create an Auth Element token
Now that we have an entity with the `data:retrieve` capability in either
the `pending_capabilities` or `available_capabilities` property,
we can create an Auth Element token.

This token will be used to launch the Auth Element in the next step.

<ElementsCreateAuthToken />

#### Response
```json
{
  "element_token": "pk_elem_f3TZsKnmP7Q69bX65hRHngBEb8mT8gbG"
}
```

---

### 3. Launch the Auth Element
Next we'll launch the Auth Element with the created `element_token` by opening the following
URL in our browser. Where `ENV` refers to the environment in which you created the
token (`dev`, `sandbox`, or `production`).

```
https://elements.{ENV}.methodfi.com?token=pk_elem_f3TZsKnmP7Q69bX65hRHngBEb8mT8gbG
```

#### Test Verification Credentials
If the token was created in the `dev` or `sandbox` environment, provide the following information
when the element prompts for it:
- __First Name__ (any first name): `Kevin`
- __Last Name__ (any last name): `Doyle`
- __Phone__: `5121231111`
- __Security Questions__: Choose any "Correct" option for all questions.

The result of this step is a `cxn_id` which is the ID of the connection that was created from
successfully verifying an entity's identity.

➡️ See [launch auth element](/api/elements/auth/implementation/launch-auth) to learn how
to retrieve the `cxn_id` from the launched element.

#### Demo
The interactive demo below shows how the Auth Element flow works. This demo is running in
the `dev` environment, so you can provide the [same information](#test-verification-credentials) mentioned above.

<iframe
  width="100%"
  height="850"
  style={{ marginTop: 30 }}
  src="https://elements.dev.methodfi.com/?demo=auth" />

---

### 4. Retrieve the created connection
Now that we've successfully completed the Auth Element flow, we can retrieve the created connection
with the `cxn_id` from the previous step. Additionally, you can also list all connections for
your team.

ℹ️ See the [connection object](/api/core/connections/object) to learn more.

#### Retrieve connection by ID
<ConnectionsRetrieve />

#### List connections
<ConnectionsList />

#### Response
```json
{
  "id": "cxn_iENwAPKnNqA5j",
  "entity_id": "ent_au22b1fbFJbp8",
  "accounts": [
    "acc_XaDZc8tE4YVeJ",
    "acc_k5NzziUDg7hTg",
    "acc_p3xR5ne3iAX6g",
    "acc_mDDi64jzWUgSx",
    "acc_EpcLnJSkSCnRM"
  ],
  "source": "method_data",
  "status": "success",
  "error": null,
  "created_at": "2022-02-16T18:02:21.866Z",
  "updated_at": "2022-02-20T22:50:45.391Z",
  "last_synced_at": "2022-02-20T22:50:45.391Z"
}
```

---

### 5. Retrieve the created liability accounts
Now we'll retrieve the accounts created from the entity's completed Auth Element.
The resulting accounts created from this flow have the following capabilities:

* `data:retrieve` capability indicating that it's enhanced and comprehensive liability data.
* `payments:receive` capability indicating that the account is fully setup to be used for payments.

<AccountsHolderMethodDataList />

#### Response

```json
[
  {
      "id": "acc_XaDZc8tE4YVeJ",
      "holder_id": "ent_au22b1fbFJbp8",
      "type": "liability",
      "ach": null,
      "liability": {
        "mch_id": "mch_21",
        "mask": "3092",
        "type": "credit_card",
        "credit_card": {
          "name": "Wells Fargo Credit Card",
          "balance": 57300,
          "last_payment_amount": 13900,
          "last_payment_date": "2022-03-21",
          "next_payment_due_date": "2022-04-21",
          "next_payment_minimum_amount": 4500,
          "opened_at": "2021-06-15"
        }
      },
      "clearing": null,
      "metadata": null,
      "status": "active",
      "capabilities": [
        "payments:receive",
        "data:retrieve"
      ],
      "error": null,
      "created_at": "2022-02-16T00:47:32.508Z",
      "updated_at": "2022-02-16T00:47:32.508Z"
    },
    {
      "id": "acc_k5NzziUDg7hTg",
      "holder_id": "ent_au22b1fbFJbp8",
      "type": "liability",
      "ach": null,
      "liability": {
        "mch_id": "mch_183",
        "mask": "6382",
        "type": "credit_card",
        "credit_card": {
          "name": "Chase Sapphire Reserve",
          "balance": 166500,
          "last_payment_amount": 63925,
          "last_payment_date": "2022-03-17",
          "next_payment_due_date": "2022-04-17",
          "next_payment_minimum_amount": 4600,
          "opened_at": "2019-03-11"
        }
      },
      "clearing": null,
      "metadata": null,
      "status": "active",
      "capabilities": [
        "payments:receive",
        "data:retrieve"
      ],
      "error": null,
      "created_at": "2022-02-16T02:56:19.548Z",
      "updated_at": "2022-02-16T02:56:19.548Z"
    },
  ...
]
```

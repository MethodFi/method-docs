---
sidebar_label: Retrieve an entity's debts
---

import EntitiesMethodDataCreateIndividual from '../../../src/snippets/EntitiesMethodDataCreateIndividual';
import ElementsAuthCallback from '../../../src/snippets/ElementsAuthCallback';
import ElementsCreateAuthToken from '../../../src/snippets/ElementsCreateAuthToken';
import EntitiesCreateIndividualAuthSession from '../../../src/snippets/EntitiesCreateIndividualAuthSession';
import EntitiesUpdateIndividualAuthSession from '../../../src/snippets/EntitiesUpdateIndividualAuthSession';
import ConnectionsRetrieve from '../../../src/snippets/ConnectionsRetrieve';
import ConnectionsList from '../../../src/snippets/ConnectionsList';
import AccountsHolderMethodDataList from '../../../src/snippets/AccountsHolderMethodDataList';


# Retrieve an entity's debts
‚ú® __Method Data__ allows you to retrieve all of an individual's debts regardless of financial institution
using just their phone number.

Liabilities retrieved using Method Data are immediately payable using [Method Payments](/guides/quick-start/create-your-first-payment)
and can receive real-time enhanced data directly from the financial institution or loan servicer using [Method Sync](/guides/quick-start/sync-a-liability)


## Steps
- [Create an individual entity](#1-create-an-individual-entity) to represent your end-user.
- [Create an Auth Element token](#2-create-an-auth-element-token) for the entity to start the identity verification process.
- [Launch the Auth Element](#3-launch-the-auth-element) with the created element token and
  complete the identity verification flow.
- [Handle Auth Element events](#4-handle-auth-element-events) generated by the identity verification process.
- [Retrieve the created liability accounts](#5-retrieve-the-created-liability-accounts) created from the connection.

---

## 1. Create an individual entity
First we'll create an individual entity. An entity is a representation of your end-user. To initiate a data retrieve
session you'll need to provide, at a minimum, the end-user's `first_name`, `last_name` and a verified `phone` number.

### Primer on capabilities
Capabilities are an indicator of an entities' status. For this flow we are interested in the `data:retrieve` capability.
The location of `data:retrieve` in an entities' capability fields indicates the next steps.

:::tip
We recommend using Method's Auth Element as it will automatically handle the provisioning / activating of capabilities.
:::

| Field                  | Meaning                                                        | Next Steps                                                                |
|------------------------|----------------------------------------------------------------|---------------------------------------------------------------------------|
| `pending_capability`   | We were unable to find the individual using the provided data. | Provide more data using [Entity Update endpoint](../../api/core/entities/update) or launch the Auth Element.    |
| `available_capability` | Entity was successfully matched with the provided data.        | Start the auth flow using [Entity Auth Session endpoint](/guides/entities/identity-verification) or launch the [Auth Element](/guides/quick-start/retrieve-an-entitys-debts#3-launch-the-auth-element). |
| `capability`           | Entity successfully completed the auth flow.                   | Retrieve all their debts using the Account endpoint.                      |

:::caution
For building / testing in Method's `dev` environment, see [Auth Element simulate requirements](/api/elements/auth/intro#simulate-requirements)
to determine what information should be submitted for an entity.
:::

#### Request

<EntitiesMethodDataCreateIndividual />

---

## 2. Create an Auth Element token
Now that we have an entity with the `data:retrieve` capability in either the `pending_capabilities` or `available_capabilities`
property, we can create an Auth Element token.

üí° As a reminder, the Auth Element handles the provisioning / activating of capabilities it will prompt the user for
KBA (knowledge-based authentication) questions and in rare-cases prompt for more information such as `dob` and `address`

:::info
If your organization is enrolled in Method's non-KBA authentication, you can skip Auth Element / Auth Session and
[retrieve the created liability accounts](#5-retrieve-the-created-liability-accounts).
:::

This token will be used to launch the Auth Element in the next step.

#### Request

<ElementsCreateAuthToken />

---

## 3. Launch the Auth Element
Next we'll launch the Auth Element with the created `element_token` by opening a webview (iframe) for the URL below.
Where `ENV` refers to the environment in which you created the token (`dev`, `sandbox`, or `production`).

```
https://elements.{ENV}.methodfi.com?token=pk_elem_f3TZsKnmP7Q69bX65hRHngBEb8mT8gbG
```

Once launched, the Element will ask for credit-report based knowledge based authentication questions
to validate the identity of the entity.

‚û°Ô∏è See [launch auth element](/api/elements/auth/implementation/launch-auth) to learn how
to implement the Auth Element within your app.

‚û°Ô∏è Use our [client libraries](../../libraries#elements-client-libraries) (React + JS) to make integration seamless.

#### Dev Environment Details
If the token was created in the `dev` environment, provide the following information
when the element prompts for it:
- __First Name__ (any first name): `Kevin`
- __Last Name__ (any last name): `Doyle`
- __Phone__: `5121231111`
- __Security Questions__: Choose any "Correct" option for all questions.

#### Demo
The interactive demo below shows how the Auth Element flow works. This demo is running in
the `dev` environment, so you can provide the _Dev Environment Details_ mentioned above.

<iframe
  width="100%"
  height="850"
  style={{ marginTop: 30 }}
  src="https://elements.dev.methodfi.com/?demo=auth" />

---

## 4. Handle Auth Element events
Method Elements communicate using callback (if using Method's client libraries) or HTTP redirect (if implemented within an iframe)
Your webview / app should intercept the redirects in order to react accordingly to state changes.

When a user has successfully verified their identity, a `success` event will be sent back to your app.

<ElementsAuthCallback />

---

## 5. Retrieve the created liability accounts
Now we'll retrieve the accounts created from the entity's completed Auth Element / Auth Session endpoint.
We'll use the entities' ID to retrieve all of the debts under their name.

The retrieved accounts created from this flow have the following capabilities:

* `data:retrieve` capability indicating that it was connected as part of this flow (Method Data).
* `payments:receive` capability indicating that the account is fully setup to be used for payments via Method Payments.
* `data:sync` capability indicating this liability can receive enhanced data and nightly data updates via Method Sync. ‚û°Ô∏è Learn more here.

#### Request

<AccountsHolderMethodDataList />

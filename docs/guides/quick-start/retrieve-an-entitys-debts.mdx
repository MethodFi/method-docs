---
sidebar_label: Retrieve an entity's debts
---

import EntitiesMethodDataCreateIndividual from '../../../src/snippets/EntitiesMethodDataCreateIndividual';
import ElementsAuthCallback from '../../../src/snippets/ElementsAuthCallback';
import EntitiesCreateIndividualAuthSession from '../../../src/snippets/EntitiesCreateIndividualAuthSession';
import EntitiesUpdateIndividualAuthSession from '../../../src/snippets/EntitiesUpdateIndividualAuthSession';
import ConnectionsRetrieve from '../../../src/snippets/ConnectionsRetrieve';
import ConnectionsList from '../../../src/snippets/ConnectionsList';
import AccountsHolderMethodDataList from '../../../src/snippets/AccountsHolderMethodDataList';


# Retrieve an entity's debts

Entities are a representation of your application's end-users. Method allows you to
automatically retrieve all of their debts regardless of financial institution or type.

## Steps
- [Create an individual entity](#1-create-an-individual-entity) to represent your end-user.
- [Create an Auth Element token](#2-create-an-auth-element-token) for the entity to start the identity verification process.
- [Launch the Auth Element](#3-launch-the-auth-element) with the created element token and
  complete the identity verification flow.
- [Handle Auth Element events](#4-handle-auth-element-events) generated by the identity verification process
- [Retrieve the created liability accounts](#5-retrieve-the-created-liability-accounts) created from the connection.

---

## 1. Create an individual entity
First we'll create an individual entity. An entity is a representation of your end-user. To initiate a data retrieve
session you'll need to provide, at a minimum, the end-user's `first_name`, `last_name` and a verified `phone` number.

### Primer on capabilities
Capabilities are an indicator of an entities' status. For this flow we are interested in the `data:retrieve` capability.
The location of `data:retrieve` in an entities' capability fields indicates the next steps.

:::tip
We recommend using Method's Auth Element as it will automatically handle the provisioning / activating of capabilities.
:::

| Field                  | Meaning                                                        | Next Steps                                                                |
|------------------------|----------------------------------------------------------------|---------------------------------------------------------------------------|
| `pending_capability`   | We were unable to find the individual using the provided data. | Provide more data using [Entity Update endpoint](../../api/core/entities/update) or launch the Auth Element.    |
| `available_capability` | Entity was successfully matched with the provided data.        | Start the auth flow using [Entity Auth Session endpoint](/guides/entities/identity-verification) or launch the [Auth Element](/guides/quick-start/retrieve-an-entitys-debts#3-launch-the-auth-element). |
| `capability`           | Entity successfully completed the auth flow.                   | Retrieve all their debts using the Account endpoint.                      |

:::caution
For building / testing in Method's `dev` environment, see [Auth Element simulate requirements](/api/elements/auth/intro#simulate-requirements)
to determine what information should be submitted for an entity.
:::

#### Request

<EntitiesMethodDataCreateIndividual />

#### Response
```json
{
  "id": "ent_au22b1fbFJbp8",
  "type": "individual",
  "individual": {
    "first_name": "Kevin",
    "last_name": "Doyle",
    "phone": "+15121231111",
    "dob": null,
    "email": null
  },
  "capabilities": [
    "payments:receive",
    "payments:send"
  ],
  "available_capabilities": [
    "data:retrieve"
  ],
  "pending_capabilities": [],
  ...
}
```

---

## 2. Create an Auth Element token
Now that we have an entity with the `data:retrieve` capability in either the `pending_capabilities` or `available_capabilities`
property, we can create an Auth Element token.

üí° As a reminder, the Auth Element handles the provisioning / activating of capabilities it will prompt the user for
KBA (knowledge-based authentication) questions and in rare-cases prompt for more information such as `dob` and `address`

This token will be used to launch the Auth Element in the next step.

#### Request

<ElementsCreateAuthToken />

#### Response
```json
{
  "element_token": "pk_elem_f3TZsKnmP7Q69bX65hRHngBEb8mT8gbG"
}
```

---

## 3. Launch the Auth Element
Next we'll launch the Auth Element with the created `element_token` by opening a webview (iframe) for the URL below.
Where `ENV` refers to the environment in which you created the token (`dev`, `sandbox`, or `production`).

```
https://elements.{ENV}.methodfi.com?token=pk_elem_f3TZsKnmP7Q69bX65hRHngBEb8mT8gbG
```

Once launched, the Element will ask for credit-report based knowledge based authentication questions
to validate the identity of the entity.

‚û°Ô∏è See [launch auth element](/api/elements/auth/implementation/launch-auth) to learn how
to implement the Auth Element within your app.

‚û°Ô∏è Use our [client libraries](../../libraries#elements-client-libraries) (React + JS) to make integration seamless.

#### Dev Environment Details
If the token was created in the `dev` environment, provide the following information
when the element prompts for it:
- __First Name__ (any first name): `Kevin`
- __Last Name__ (any last name): `Doyle`
- __Phone__: `5121231111`
- __Security Questions__: Choose any "Correct" option for all questions.

#### Demo
The interactive demo below shows how the Auth Element flow works. This demo is running in
the `dev` environment, so you can provide the _Dev Environment Details_ mentioned above.

<iframe
  width="100%"
  height="850"
  style={{ marginTop: 30 }}
  src="https://elements.dev.methodfi.com/?demo=auth" />

---

## 4. Handle Auth Element events
Method Elements communicate using callback (if using Method's client libraries) or HTTP redirect (if implemented within an iframe)
Your webview / app should intercept the redirects in order to react accordingly to state changes.

When a user has successfully verified their identity, a `success` event will be sent back to your app.

<ElementsAuthCallback />

---

## 5. Retrieve the created liability accounts
Now we'll retrieve the accounts created from the entity's completed Auth Element.
We'll use the entities' ID to retrieve all of the debts under their name.

The retrieved accounts created from this flow have the following capabilities:

* `data:retrieve` capability indicating that it was connected as part of this flow (Method Data).
* `payments:receive` capability indicating that the account is fully setup to be used for payments via Method Payments.
* `data:sync` capability indicating this liability can receive enhanced data and nightly data updates via Method Sync. ‚û°Ô∏è Learn more here.

<AccountsHolderMethodDataList />

#### Response

```json
[
    {
      "id": "acc_XaDZc8tE4YVeJ",
      "holder_id": "ent_au22b1fbFJbp8",
      "type": "liability",
      "ach": null,
      "liability": {
        "mch_id": "mch_2347",
        "mask": "4512",
        "type": "auto_loan",
        "data_status": "pending",
        "data_last_successful_sync": null,
        "auto_loan": {
          "name": "Volvo Cars Auto Loan",
          "sub_type": "loan",
          "balance": 6083960,
          "opened_at": null,
          "payoff_amount": null,
          "payoff_amount_term": null,
          "last_payment_amount": 88800,
          "last_payment_date": "2022-05-12",
          "next_payment_due_date": "2022-06-01",
          "next_payment_minimum_amount": 88883,
          "term_length": 84,
          "interest_rate_percentage": 5.7,
          "interest_rate_type": "fixed"
        }
      },
      "status": "active",
      "capabilities": [
        "payments:receive",
        "data:retrieve"
      ],
      "available_capabilities": [
        "data:sync"
      ],
      "error": null,
      "created_at": "2022-02-16T00:47:32.508Z",
      "updated_at": "2022-02-16T00:47:32.508Z"
    },
    {
      "id": "acc_k5NzziUDg7hTg",
      "holder_id": "ent_au22b1fbFJbp8",
      "type": "liability",
      "liability": {
        "mch_id": "mch_183",
        "mask": "6382",
        "type": "credit_card",
        "data_status": "pending",
        "data_last_successful_sync": null,
        "credit_card": {
          "name": "Chase Sapphire Reserve",
          "balance": 550472,
          "opened_at": "2016-11-25",
          "last_payment_date": "2022-05-27",
          "last_payment_amount": 361000,
          "next_payment_due_date": null,
          "next_payment_minimum_amount": null,
          "last_statement_balance": 760501,
          "remaining_statement_balance": 0,
          "available_credit": 1788500,
          "pending_purchase_authorization_amount": 54136,
          "pending_credit_authorization_amount": null,
          "interest_saving_balance": null,
          "interest_rate_percentage": 21.75,
          "interest_rate_type": "variable"
        }
      },
      "status": "active",
      "capabilities": [
        "payments:receive",
        "data:retrieve"
      ],
      "available_capabilities": [
        "data:sync"
      ],
      "error": null,
      "created_at": "2022-02-16T02:56:19.548Z",
      "updated_at": "2022-02-16T02:56:19.548Z"
    },
  ...
]
```
